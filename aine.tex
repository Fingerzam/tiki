% --- Template for thesis / report with tktltiki2 class ---

\documentclass[finnish]{tktltiki2}

% tktltiki2 automatically loads babel, so you can simply
% give the language parameter (e.g. finnish, swedish, english, british) as
% a parameter for the class: \documentclass[finnish]{tktltiki2}.
% The information on title and abstract is generated automatically depending on
% the language, see below if you need to change any of these manually.
% 
% Class options:
% - grading                 -- Print labels for grading information on the front page.
% - disablelastpagecounter  -- Disables the automatic generation of page number information
%                              in the abstract. See also \numberofpagesinformation{} command below.
%
% The class also respects the following options of article class:
%   10pt, 11pt, 12pt, final, draft, oneside, twoside,
%   openright, openany, onecolumn, twocolumn, leqno, fleqn
%
% The default font size is 11pt. The paper size used is A4, other sizes are not supported.
%
% rubber: module pdftex

% --- General packages ---

\usepackage[utf8]{luainputenc}
\usepackage{lmodern}
\usepackage{microtype}
\usepackage{amsfonts,amsmath,amssymb,amsthm,booktabs,color,enumitem,graphicx}
\usepackage[pdftex,hidelinks]{hyperref}
\usepackage{xifthen}
\usepackage{luacode}

\usepackage{pgf}
\usepackage{tikz}
\usetikzlibrary{graphs, graphs.standard}
\usetikzlibrary{arrows}
\usetikzlibrary{calc}
\usetikzlibrary{decorations.markings}

\pgfkeys{
    /aine/.is family, /aine,
    circle radius/.estore in = \circleradius,
    hilight radius/.estore in = \hilightradius,
    node count/.estore in = \nodecount,
    arc start/.estore in = \arcstart,
    arc end/.estore in = \arcend
}

% Automatically set the PDF metadata fields
\makeatletter
\AtBeginDocument{\hypersetup{pdftitle = {\@title}, pdfauthor = {\@author}}}
\makeatother

% --- Language-related settings ---
%
% these should be modified according to your language

% babelbib for non-english bibliography using bibtex
\usepackage[fixlanguage]{babelbib}
\selectbiblanguage{finnish}

% add bibliography to the table of contents
\usepackage[nottoc,numbib]{tocbibind}
% tocbibind renames the bibliography, use the following to change it back
\settocbibname{Lähteet}

% --- Theorem environment definitions ---

\newtheorem{lau}{Lause}
\newtheorem{lem}[lau]{Lemma}
\newtheorem{kor}[lau]{Korollaari}

\theoremstyle{definition}
\newtheorem{maar}[lau]{Määritelmä}
\newtheorem{ong}{Ongelma}
\newtheorem{alg}[lau]{Algoritmi}
\newtheorem{esim}[lau]{Esimerkki}

\theoremstyle{remark}
\newtheorem*{huom}{Huomautus}

\newcommand{\set}[1]{\left\{ #1 \right\}}
\newcommand{\nat}{\mathbb{N}}
\newcommand{\powerset}{\mathcal{P}}

\newcommand{\from}{\colon}
\newcommand{\compose}{\circ}

\DeclareMathOperator{\id}{ID}

\DeclareMathOperator{\head}{head}
\DeclareMathOperator{\tail}{tail}

\DeclareMathOperator{\DL}{DL}

\newcommand{\cycleGraph}[2]
{
\begin{tikzpicture}
    \draw circle [radius=#1];
    \graph [nodes={draw, circle,fill=white}, clockwise, radius=#1, empty nodes]{
        subgraph I_n [n = #2]
    };
\end{tikzpicture}
}

\newcommand{\Dsn}{D_{s,n}}
\newcommand{\Dssn}{D_{s+1,n}}



% --- tktltiki2 options ---
%
% The following commands define the information used to generate title and
% abstract pages. The following entries should be always specified:

\title{Paikallisuus hajautetuissa verkkoalgoritmeissa}
\author{Juhana Laurinharju}
\date{\today}
\level{Kandidaatintutkielma}

\abstract{Olkoon $n$ tietokonetta asetettu sykliin siten, että jokainen voi
    kommunikoida vain kahden naapurinsa kanssa. Verkon värityksessä jokaiselle
    verkon solmulle täytyy antaa väri siten, että kahdella vierekkäisellä
    solmulla ei saa olla samaa väriä. Linial (1992) on todistanut, että tällöin
    hajautettu algoritmi, joka haluaa värittää syklin solmut kolmella värillä,
    käyttää tähän pahimmassa tapauksessa vähintään $\Omega(\log^* n)$
    kommunikaatiokierrosta. Tässä työssä esitellään Linialin alarajatodistus.
}

% The following can be used to specify keywords and classification of the paper:

\keywords{Hajautetut algoritmit, Verkon väritys}
%\classification{} % classification according to ACM Computing Classification System (http://www.acm.org/about/class/)
                  % This is probably mostly relevant for computer scientists

% If the automatic page number counting is not working as desired in your case,
% uncomment the following to manually set the number of pages displayed in the abstract page:
%
% \numberofpagesinformation{16 sivua + 10 sivua liitteissä}
%
% If you are not a computer scientist, you will want to uncomment the following by hand and specify
% your department, faculty and subject by hand:
%
% \faculty{Matemaattis-luonnontieteellinen}
% \department{Tietojenkäsittelytieteen laitos}
% \subject{Tietojenkäsittelytiede}
%
% If you are not from the University of Helsinki, then you will most likely want to set these also:
%
% \university{Helsingin Yliopisto}
% \universitylong{HELSINGIN YLIOPISTO --- HELSINGFORS UNIVERSITET --- UNIVERSITY OF HELSINKI} % displayed on the top of the abstract page
% \city{Helsinki}
%


\begin{document}

% --- Front matter ---

\maketitle        % title page
\makeabstract     % abstract page

\tableofcontents  % table of contents
\newpage          % clear page after the table of contents


% --- Main matter ---

\section{Johdanto}

Hajautettu laskenta tarkastelee asetelmaa, jossa verkon solmut ovat
tietokoneita, jotka voivat kommunikoida keskenään verkon kaaria pitkin.
Erityisesti hajautetussa asetelmassa tietokoneet haluavat ratkaista
yhteistyössä jonkin kommunikaatioverkkoa koskevan laskennallisen ongelman.
Hajautettu algoritmi voi lähettää ja vastaanottaa viestejä synkronoiduissa
kommunikaatiokierroksissa. Algoritmin suoritusaikana tarkastellaan
kommunikaatiokierrosten lukumäärää.

Paikallinen algoritmi on vakioaikainen hajautettu algoritmi. Jokainen solmu saa
siis laskettua tällöin oman vastauksensa vakiomäärässä kommunikointikierroksia.
Tässä työssä esitellään Linialin~\cite{linial92} klassinen todistus sille, että
hajautettu algoritmi käyttää ainakin $\Omega(\log^* n)$ kommunikaatiokierrosta
$n$:n solmun sykliverkon värittämiseen kolmella värillä. Tämä tulos siis
näyttää, ettei ole olemassa paikallista algoritmia joka, värittäisi syklin
kolmella värillä.

Tämä alarajatulos on myös asymptoottisesti tiukka, sillä Colen ja Vishkinin
algoritmi~\cite{colevishkin86} värittää $n$-solmuisen syklin hajautetusti
kolmella värillä $\mathcal{O}(\log^* n)$ kierroksessa. Linial näyttää alarajan
deterministiselle algoritmille, mutta Naor~\cite{naor91} on yleistänyt tuloksen
myös satunnaisuutta käyttäville hajautetuille algoritmeille.

Luvussa 2 esitellään tuloksessa todistamiseen tarvittavat määritelmät ja
luvussa 3 esitetään itse alarajatodistus.

\section{Määritelmiä}

\subsection{Verkko}

\begin{maar}
    \emph{Suuntaamaton verkko} on pari $G = (V,E)$, missä $V$ on
    \emph{solmujoukko} ja $E$ on \emph{kaarijoukko}. \emph{Kaari} solmusta $v
    \in V$ solmuun $u \in V$ on kaksikko $\set{v,u} \in E$. Kaarta voidaan myös
    merkitä lyhyemmin $vu$. Jos $G$ on suuntaamaton verkko, niin sen
    solmujoukkoon voidaan viitata myös merkinnällä $V(G)$ ja kaarijoukkoon
    merkinnällä $E(G)$.
\end{maar}

Esimerkiksi verkko $G = (V,E)$, missä
%
\begin{align*}
    V &= \set{a,b,c,d} \text{ ja}\\
    E &= \set{ \set{a,b}, \set{b,c}, \set{c,a}, \set{a,d}} \\
      &= \set{ab, bc, ca, ad},
\end{align*}
%
näyttää seuraavalta:
%
\begin{center}
    \begin{tikzpicture}
        \graph[nodes={circle, draw, minimum size=7mm}, clockwise]{
            subgraph C_n [V={a,b,c}];
            a -- d[x=2, y=0];
        };
    \end{tikzpicture}
\end{center}

\begin{maar}
    Kaikilla posiitivisilla kokonaisluvuilla $k$ merkitään:
    %
    \begin{equation*}
        [k] = \set{1, \dots, k}.
    \end{equation*}
\end{maar}

\subsection{Laskennan malli}

Olkoon $G = (V,E)$ suuntaamaton verkko. Verkon jokaisessa solmussa $v \in V$ on
tietokone. Laskenta koostuu \emph{kommunikaatiokierroksista}. Yhden
kommunikaatiokierroksen aikana jokainen solmu voi

\begin{enumerate}
    \item suorittaa mielivaltaista laskentaa,
    \item lähettää viestin jokaiselle naapurilleen ja
    \item vastaanottaa naapureiden lähettämät viestit.
\end{enumerate}

Lisäksi jokaiselle solmulle $v \in V$ on annettu yksikäsitteinen tunniste
$\id(v) \in [|V|]$. Laskennan päätyttyä jokaisen solmun tulee
tietää oma tulosteensa.

Hajautetun algoritmin aikavaativuutena tarkastellaan kommunikaatiokierrosten
lukumäärää. Solmujen suorittama mielivaltainen laskenta jä\-te\-tään siis
aikavaativuusanalyysissä huomiotta. Hajautettua algoritmia ajatellaan ajettavan
jossain tietokoneverkossa, jolloin viestien välittäminen tietokoneiden välillä
on huomattavan hidasta verrattuna tietokoneen sisäiseen viestinvälitykseen ja
laskentaan.

\subsection{Verkon väritys}

\begin{maar}
    Verkko on \emph{väritetty}, jos jokaiseen solmuun $v \in V$ on liitetty
    jokin \emph{väri} $c(v) \in \nat$ ja kahdella vierekkäisellä solmulla ei
    koskaan ole samaa väriä.  Tarkemmin, verkon $G = (V,E)$ \emph{solmuväritys}
    on kuvaus $c \from V \to [k]$ jollain luonnollisella luvulla $k \in \nat$.
    Lisäksi vaaditaan, että jos verkossa on kaari solmusta $v$ solmuun $u$, eli
    $vu \in E$, niin $c(v) \neq c(u)$.
\end{maar}

Verkon voi värittää $k$:lla värillä jos löytyy yllä olevan ehdon täyttävä
kuvaus $c \from V \to [k]$. Tällaista väritystä kutsutaan
\emph{$k$-väritykseksi}. Esimerkiksi seuraava verkko on 4-väritetty.

\definecolor{color1}{RGB}{166, 206, 227}
\definecolor{color2}{RGB}{31, 120, 180}
\definecolor{color3}{RGB}{178, 223, 138}%{51, 160, 4}
\definecolor{color4}{RGB}{255, 255, 255}

%{230, 97, 1}
%{253, 184, 99}
%{178, 171, 210}
%{94, 60, 153}

\begin{center}
    \begin{tikzpicture}[nodes={draw, circle, inner sep=.13cm}]
        \node [fill=color1] (a1) at (0,0)       {};
        \node [fill=color1] (a2) at (1,0)       {};
        \node [fill=color2] (a3) at (0,1)       {};
        \node [fill=color3] (a4) at (1,1.5)     {};
        \node [fill=color2] (a5) at (2,0.75)    {};
        \node [fill=color1] (a6) at (3,1.5)     {};
        \node [fill=color3] (a7) at (3,0)       {};
        \node [fill=color4] (a8) at (3.75,0.75) {};

        \graph {
            (a3) -- {(a1), (a2), (a4)},
            (a4) -- {(a2), (a5)},
            (a5) -- {(a2), (a6), (a7)},
            (a8) -- {(a5), (a6), (a7)},
            (a4) -- (a6)
        };
    \end{tikzpicture}
\end{center}

Jos verkkoa väritetään hajautetulla algoritmilla, niin jokaisen solmun tulee
tietää oma värinsä laskennan päätyttyä.

\subsection{Sykli}

\begin{maar}
    Verkko on \emph{sykli}, jos se on yhtenäinen ja sen jokaisella solmulla on
    tasan kaksi naapuria.
\end{maar}

Toisin sanoen, $n$-sykli, missä $n \geq 3$, on verkko $C_n = (V,E)$, jolla
%
\begin{align*}
    V &= \set{v_1, v_2, \dots, v_n} \\
    E &= \set{v_iv_{i+1} \mid 1 \leq i < n} \cup \set{v_n v_1}.
\end{align*}
%
\begin{figure}[t]
    \begin{center}
        \begin{tabular}{ccc}
            \cycleGraph{.95cm}{6} & \cycleGraph{.95cm}{3} & \cycleGraph{.95cm}{9} \\
            $C_6$ & $C_3$ & $C_9$
        \end{tabular}
        \caption{Esimerkkejä sykleistä}
    \end{center}
\end{figure}
%
Syklin voi aina värittää kolmella värillä, sillä väritysehdon täyttävä kuvaus
$c \from V(C_n) \to \set{1,2,3}$ voidaan määritellä esimerkiksi seuraavasti:
%
\begin{equation*}
    c(v_i) =
    \begin{cases}
        3, &\text{jos } i = n, \\
        1, &\text{jos } i < n \text{ ja } i \text{ on parillinen ja} \\
        2, &\text{jos } i < n \text{ ja } i \text{ on pariton.}
    \end{cases}
\end{equation*}
%
Tällä funktiolla väritetyt syklit näyttävät seuraavalta:

%TODO: tälle lähde?

\begin{luacode*}
    function coloredCycle(k)
        tex.print("\\begin{tikzpicture}", "")
        tex.print("\\draw circle [radius=.95cm];", "")
        tex.print(" \\graph [simple,nodes={draw, circle,fill=white}, clockwise, radius=.95cm, n="..k..", empty nodes]{ ", "")
        for i = 1,k-1 do
            if math.fmod(i,2) == 0 then
                tex.print(i.." [fill=color1];", "")
            else
                tex.print(i.." [fill=color2];", "")
            end
        end
        tex.print(k.." [fill=color3];", "")

        tex.print("};", "")
        tex.print("\\end{tikzpicture}", "")
    end
\end{luacode*}

\newcommand*\coloredCycle[1]{
    \luadirect{coloredCycle(tonumber(#1))}
}

\begin{center}
    \begin{tabular}{ccc}
        \coloredCycle{6} & \coloredCycle{3} & \coloredCycle{9} \\
    \end{tabular}
\end{center}

\subsection{Iteroitu logaritmi $\log^*$}

Tässä työssä logaritmien kantaluku on aina 2.

\begin{maar}
    \emph{Iteroitu logaritmi} $\log^*$ kertoo kuinka monta kertaa luvusta täytyy ottaa
    logaritmi, kunnes lopputulos on korkeintaan yksi. Tarkemmin,
    %
    \begin{equation*}
        \log^* x =
          \begin{cases}
              0,                   &\text{jos } x \leq 1, \\
              1 + \log^* (\log x)  &\text{muutoin.}
          \end{cases}
    \end{equation*}
\end{maar}

Esimerkiksi
%
\begin{align*}
    \log^* 16 &= \log^* 2^{2^2} = 1 + \log^* 2^2 \\
              &= 2+ \log^* 2 = 3 + \log^* 1 = 3 \\
\intertext{ja}
    \log^* 65536 &= \log^* 2^{2^{2^2}} = 1 + \log^* 16 \\
                 &= 4,
\end{align*}
%
joten $\log^* n$ on arvoltaan pienempi kuin 5, kun $n < 2^{65536}$. Iteroitu
logaritmi on siis äärimmäisen hitaasti kasvava funktio.

\subsection{Näkymä}

\begin{maar}
    Verkon $G$ \emph{polku} on jono $P = (p_0, \dots, p_n)$, missä jokainen
    $p_i \in V(G)$ on verkon $G$ solmu, kahden jonon perättäisen solmun välillä
    täytyy aina olla kaari ja lisäksi sama solmu ei saa esiintyä jonossa
    kahdesti. Siis kaikilla $i \in \set{0, \dots, n-1}$ täytyy olla voimassa ehto $p_i
    p_{i+1} \in E(G)$. Lisäksi kaikilla $i,j \in \set{0,\dots,n}, i \neq j$ täytyy olla
    voimassa ehto $p_i \neq p_j$. Polku $P$ on polku solmusta $p_1$ solmuun
    $p_n$.
\end{maar}

\begin{figure}[htb]
    \centering
    \begin{tabular}{cc}
            \begin{tikzpicture}
                \graph[nodes={draw,circle, minimum size=7.5mm}, no placement] {
                    1[x=0,y=0];
                    2[x=0,y=1];
                    3[x=0,y=2, ultra thick];
                    4[x=1,y=1, ultra thick];
                    5[x=2,y=2];
                    6[x=3,y=1, ultra thick];
                    7[x=2,y=0, ultra thick];
                    8[x=3.5,y=2, ultra thick];
                    9[x=4.5,y=2, ultra thick];
                    10[x=4,y=0];
                    11[x=5,y=1];
        
                    {1,2} -- 4 -- 5 -- 6 --[ultra thick] 7;
                    3 --[ultra thick] 4;
                    3 -- 5;
                    7 --[ultra thick] 4;
                    6 --[ultra thick] 8 --[ultra thick] 9 -- 10 -- 11;
                    6 -- 9 -- 11;
                    6 -- 10;
                };
            \end{tikzpicture}
            &
            \begin{tikzpicture}
                \graph[nodes={draw,circle, minimum size=7.5mm}, no placement] {
                    1[x=0,y=0];
                    2[x=0,y=1];
                    3[x=0,y=2, ultra thick];
                    4[x=1,y=1];
                    5[x=2,y=2, ultra thick];
                    6[x=3,y=1, ultra thick];
                    7[x=2,y=0];
                    8[x=3.5,y=2];
                    9[x=4.5,y=2, ultra thick];
                    10[x=4,y=0];
                    11[x=5,y=1];

                    {1,2} -- 4 -- 5 --[ultra thick] 6 -- 7;
                    3 -- 4;
                    3 --[ultra thick] 5;
                    7 -- 4;
                    6 -- 8 -- 9 -- 10 -- 11;
                    6 --[ultra thick] 9 -- 11;
                    6 -- 10;
                };
            \end{tikzpicture}
            \\
            (a) & (b) \\
    \end{tabular}

    \caption{(a) Polku $(3,4,7,6,8,9)$ solmusta 3 solmuun 9. (b) Lyhin polku
        solmusta 3 solmuun 9.}

    \label{fig:polku}
\end{figure}

\begin{maar}
    Polun $P = (p_0, \dots, p_n)$ pituus on sen kaarten lukumäärä. Siis polun
    $P$ pituus on $n$.
\end{maar}

Kuvan \ref{fig:polku}a polun pituus on 5.

\begin{maar}
    Verkon $G$ solmujen $u,v \in V(G)$ välinen \emph{etäisyys} on lyhimmän
    solmusta $u$ solmuun $v$ kulkevan polun pituus.
\end{maar}

Kuvassa \ref{fig:polku}b on havainnollistettu lyhintä polkua solmusta 3
solmuun 9. Solmujen 3 ja 9 välinen etäisyys on 3.

\begin{figure}[bht]
    \begin{tabular}{cc}
        \begin{tikzpicture}
            \graph[nodes={draw,circle, minimum size=7.5mm}, no placement] {
                1[x=0,y=0];
                2[x=0,y=1];
                3[x=0,y=2];
                4[x=1,y=1];
                5[x=2,y=2];
                6[x=3,y=1, ultra thick];
                7[x=2,y=0];
                8[x=3.5,y=2];
                9[x=4.5,y=2];
                10[x=4,y=0];
                11[x=5,y=1];

                {1,2} -- 4 -- 5 -- 6 -- 7;
                3 -- 4;
                3 -- 5;
                7 -- 4;
                6 -- 8 -- 9 -- 10 -- 11;
                6 -- 9 -- 11;
                6 -- 10;
            };
        \end{tikzpicture}
        &
        \begin{tikzpicture}
            \graph[nodes={draw,circle, minimum size=7.5mm}, no placement] {
                1[x=0,y=0];
                2[x=0,y=1];
                3[x=0,y=2];
                4[x=1,y=1];
                5[x=2,y=2, ultra thick];
                6[x=3,y=1, ultra thick];
                7[x=2,y=0, ultra thick];
                8[x=3.5,y=2, ultra thick];
                9[x=4.5,y=2, ultra thick];
                10[x=4,y=0, ultra thick];
                11[x=5,y=1];
    
                {1,2} -- 4 -- 5 --[ultra thick] 6 --[ultra thick] 7;
                3 -- 4;
                3 -- 5;
                7 -- 4;
                6 --[ultra thick] 8 -- 9 -- 10 -- 11;
                6 --[ultra thick] 9 -- 11;
                6 --[ultra thick] 10;
            };
        \end{tikzpicture}
        \\

        (a) & (b) \\

        \begin{tikzpicture}
            \graph[nodes={draw,circle, minimum size=7.5mm}, no placement] {
                1[x=0,y=0];
                2[x=0,y=1];
                3[x=0,y=2, ultra thick];
                4[x=1,y=1, ultra thick];
                5[x=2,y=2, ultra thick];
                6[x=3,y=1, ultra thick];
                7[x=2,y=0, ultra thick];
                8[x=3.5,y=2, ultra thick];
                9[x=4.5,y=2, ultra thick];
                10[x=4,y=0, ultra thick];
                11[x=5,y=1, ultra thick];
    
                {1,2} -- 4 --[ultra thick] 5 --[ultra thick] 6 --[ultra thick] 7;
                3 -- 4;
                3 --[ultra thick] 5;
                7 --[ultra thick] 4;
                6 --[ultra thick] 8 --[ultra thick] 9 --[ultra thick] 10 --[ultra thick]11;
                6 --[ultra thick] 9 --[ultra thick] 11;
                6 --[ultra thick] 10;
            };
        \end{tikzpicture}
        &
        \begin{tikzpicture}
            \graph[nodes={draw,circle, minimum size=7.5mm}, no placement] {
                1[x=0,y=0, ultra thick];
                2[x=0,y=1, ultra thick];
                3[x=0,y=2, ultra thick];
                4[x=1,y=1, ultra thick];
                5[x=2,y=2, ultra thick];
                6[x=3,y=1, ultra thick];
                7[x=2,y=0, ultra thick];
                8[x=3.5,y=2, ultra thick];
                9[x=4.5,y=2, ultra thick];
                10[x=4,y=0, ultra thick];
                11[x=5,y=1, ultra thick];
    
                {1,2} --[ultra thick] 4 --[ultra thick] 5 --[ultra thick] 6 --[ultra thick] 7;
                3 --[ultra thick] 4;
                3 --[ultra thick] 5;
                7 --[ultra thick] 4;
                6 --[ultra thick] 8 --[ultra thick] 9 --[ultra thick] 10 --[ultra thick]11;
                6 --[ultra thick] 9 --[ultra thick] 11;
                6 --[ultra thick] 10;
            };
        \end{tikzpicture}
        \\

        (c) & (d) \\
    \end{tabular}

    \caption{(a) Solmun 6 näkemä alue verkossa ennen ensimmäistä kierrosta.
        (b)--(d) Solmun 6 näkemä alue verkossa kierrosten 1--3 jälkeen. }

    \label{fig:nakyma}

\end{figure}

Hajautetussa algoritmissa solmu $v \in V$ saa $k$:ssa kierroksessa selville
oman $k$-ympäristönsä. Toisaalta solmu ei pysty tässä ajassa saamaan mitään
selville solmuista, joiden etäisyys $v$:stä on yli $k$. Kuvassa
\ref{fig:nakyma} havainnollistetaan solmun näkymää.

\begin{luacode*}
    function hilightRadius(args)
        local nodeDistanceInDegrees = 360/args.nodeCount
        local arcRadiusInDegrees = nodeDistanceInDegrees*args.hilightRadius
        local startingDegree = 90 - arcRadiusInDegrees
        local endingDegree = 90 + arcRadiusInDegrees
        tex.print("\\draw circle [radius=".. args.circleRadius .."];")
        tex.print("\\coordinate (a) at (0,0);","")
        tex.print("\\coordinate (b) at (".. args.circleRadius ..", 0cm);","")
        tex.print("\\coordinate (x) at ($ (a)!1!".. startingDegree ..":(b)$);","")
        tex.print("\\draw (x) arc (".. startingDegree ..":".. endingDegree ..":".. args.circleRadius ..") [visible];", "")
        tex.print("\\graph [simple,nodes={draw, circle,fill=white}, clockwise, radius=".. args.circleRadius ..", n=" .. args.nodeCount .. ", empty nodes] {", "")
        local n = args.nodeCount
        local r = args.hilightRadius
        for i=1,n do
            if (i-1 <= r or i > n-r) then
                tex.print(i .. " [visible];", "")
            else
                tex.print(i .. ";", "")
            end
        end
        tex.print("};", "")
    end
\end{luacode*}

\newcommand*\hilightRadius[1][]{
    \pgfkeys{/aine,
             /circle radius/.default=1.5cm,
             /hilight radius/.value required,
             /node count/.value required,
             #1}

    \luadirect{hilightRadius{circleRadius="\circleradius",
                             hilightRadius=\hilightradius,
                             nodeCount=\nodecount}}
}

\newcommand\circleNeighbourhood[1]{
    \tikz[visible/.style={ultra thick}]{
        \hilightRadius[#1]
    }
}
\begin{figure}[tb]
    \centering
    \begin{tabular}{ccc}
        \circleNeighbourhood{circle radius=1.5cm, hilight radius=0, node count=13} &
        \circleNeighbourhood{circle radius=1.5cm, hilight radius=1, node count=13} &
        \circleNeighbourhood{circle radius=1.5cm, hilight radius=2, node count=13} \\

        (a) & (b) & (c) \\

        \circleNeighbourhood{circle radius=1.5cm, hilight radius=3, node count=13} &
        \circleNeighbourhood{circle radius=1.5cm, hilight radius=4, node count=13} &
        \circleNeighbourhood{circle radius=1.5cm, hilight radius=5, node count=13} \\

        (d) & (e) & (f) \\
    \end{tabular}

    \caption{Solmun näkemä alue syklissä: (a) Ennen ensimmäistä
        kommunikaatiokierrosta solmu näkee vain itsensä. (b)--(f) Solmun näkemä
        alue 1--5 kommunikaatiokierroksen jälkeen.}

    \label{fig:syklinakyma}

\end{figure}

Hajautettu algoritmi, jonka ajoaika on $k$ kierrosta, on siis funktio, jonka
lähtöjoukkona on solmujen mahdolliset $k$-ympäristöt.  Erityisesti syklissä
algoritmi, jonka ajoaika on $k$ kierrosta, tekee pää\-tök\-sen\-sä $k$:n
edeltäjän, $k$:n seuraajan ja oman tunnisteensa perusteella.  Toisin sanoen
solmun $v_l \in V(C_n)$ tuloste on funktio arvoilta
%
\begin{equation*}
    \bigl(
        \id(v_{l-k}), \id(v_{l-k+1}), \dots,
        \id(v_{l-1}), \id(v_l), \id(v_{l+1}), \dots, \id(v_{l+k})
    \bigr),
\end{equation*}
%
missä yhteen- ja vähennyslaskut suoritetaan modulo $n$. Kuvassa
\ref{fig:syklinakyma} on havainnollistettu solmun näkemää aluetta syklissä eri
kommunikaatiokierrosten jälkeen.


Erityisesti jos algoritmi tuottaa 3-värityksen $n$-syklissä $k$:ssa
kierroksessa, niin täytyy olla olemassa sellainen funktio $f \from [n]^{2k+1} \to
[3]$, joka tuottaa laillisen 3-värityksen riippumatta siitä miten solmuille on
annettu tunnisteet.

%TODO: onko karteesinen potenssi kohdeyleisölle tuttu?

\subsection{Naapurustoverkot}

\newcommand{\Btn}{B_{t,n}}
\begin{maar}
    Naapurustoverkko $\Btn = (V,E)$ on verkko, jonka solmujoukon $V$ muodostaa
    vektoreiden $(x_1,\dots,x_{2t+1})$ joukko, missä $x_i$:t ovat keskenään
    erisuuria kokonaislukuja joukosta $[n]$.  Verkossa $B_{t,n}$ solmut muotoa
    %
    \begin{equation*}
        (x_1, \dots, x_{2t+1}) \text{ ja } (y, x_1, x_2, \dots, x_{2t})
    \end{equation*}
    %
    ovat naapureita, kun $y \neq x_{2t+1}$.
\end{maar}

Naapurustoverkon $\Btn$ solmu on siis syklissä ajetun hajautetun algoritmin
näkymä $t$ kierroksen jälkeen. Kahden näkymän välillä on naapurustoverkossa
kaari, jos ne ovat vierekkäisten solmujen näkymät jossain yksikäsitteisillä
tunnisteilla varustetussa $n$-syklissä.

\begin{maar}
    Solmun $v \in V(G)$ \emph{asteluku} on sen naapureiden lukumäärä verkossa
    $G$. Tarkemmin, solmun $v \in V(G)$ asteluku on
    %
    \begin{equation*}
        \bigl|
          \set{e \in E(G) \mid v \in e}
        \bigr|.
    \end{equation*}
\end{maar}

Verkossa $B_{t,n}$ on
%
\begin{equation*}
    n(n-1)(n-2) \cdots (n-2t)
\end{equation*}
%
solmua ja sen kaikkien solmujen asteluku on $2(n-2t-1)$.

%TODO: onko asteluvusta puhuminen olennaista?

%TODO: epäkonsistenttia: kierrosmäärä on välillä $k$ ja välillä $t$

Hajautettu algoritmi, joka 3-värittää syklin $t$ kierroksessa antaa jokaiselle
solmulle värin tarkastelemalla vain sen $t$-ympäristön tunnisteita.
Vä\-ri\-tys\-al\-go\-rit\-mi on siis funktio $c \from V(\Btn) \to
[3]$, sillä naapurustoverkossa $\Btn$ on solmuina kaikki mahdolliset $n$-syklin
$t$-naapurustot.

Nyt $c$ on myös laillinen 3-väritys verkolle $B_{t,n}$, sillä jos $c$ antaisi
solmuille
%
\begin{equation*}
    (x_1, \dots, x_{2t}, x_{2t+1}) \text{ ja } (y,x_1,\dots,x_{2t})
\end{equation*}
%
saman värin, niin se antaisi myös syklissa kahdelle vierekkäiselle solmulle
saman värin kun syklissä esiintyy pätkä
%
\begin{equation*}
    y, x_1, x_2, \dots, x_{2t+1}.
\end{equation*}
%
Tämä olisi kuitenkin ristiriidassa sen kanssa, että $c$ onnistuisi värittämään
$n$-syklin $t$ kierroksessa kolmella värillä. Siis algoritmi joka värittää
$n$-syklin kolmella värillä $t$ kierroksessa värittää myös naapurustoverkon
$\Btn$ kolmella värillä.

Erityisesti, jos voidaan näyttää, että verkkoa $B_{t,n}$ ei voi 3-värittää, niin ei voi
myös\-kään olla hajautettua algoritmia joka värittäisi $n$-syklin kolmella
värillä $t$ kierroksessa.


\begin{maar}
    \emph{Suunnattu verkko} $G = (V,E)$ on verkko, jossa kaarilla on suunta.
    Suunnatussa verkossa on kaari solmusta $u \in V$ solmuun $v \in V$ jos
    $(u,v) \in E$. Suunnatussa verkossa kaari $(u,v) \in E(G)$ piirretään
    nuolena solmusta $u$ solmuun $v$.
\end{maar}

\tikzset{
  big arrow/.style={
    decoration={markings,mark=at position 1 with {\arrow[scale=2,#1]{>}}},
    postaction={decorate},
    shorten >=0.4pt},
  big arrow/.default=black}

\begin{center}
    \begin{tikzpicture}[nodes={draw,circle}]
        \node (a) at (1,1) {};
        \node (b) at (2,1) {};
        \node (c) at (1,0) {};
        \node (d) at (2,0) {};

        \draw[big arrow] (a) -> (b);
        \draw[big arrow] (a) -> (c);
        \draw[big arrow] (a) -> (d);
        \draw[big arrow] (b) -> (c);
        \draw[big arrow] (b) -> (d);
        \draw[big arrow] (c) -> (d);

    \end{tikzpicture}
%    \tikz{
%        \graph[nodes={draw,circle},clockwise, n=5, empty nodes] {
%            1;
%            2;
%            3;
%            4;
%            5;
%            1 -> {2,3,4,5};
%            2 -> {3,4,5};
%            3 -> {4,5};
%            4 -> {5};
%        };
%    }
\end{center}

\begin{maar}
    Suunnatulla kaarella $e = (u,v) \in E$ on \emph{kärki} $\head(e) = v$ ja
    \emph{häntä} $\tail(e) = u$.
\end{maar}

\begin{center}
    \tikz{
        \node [label=above:{$\tail(e)$},draw,circle] (tail) at (0,0) {};
        \node [label=above:{$\head(e)$},draw,circle] (head) at (2,0) {};
        \draw[big arrow] (tail) -> (head);
        \graph{
            (tail) ->[edge label'={$e$}] (head);
        };
    }
\end{center}


%TODO: yksi esimerkki jostain leveemmästä suunnatusta verkosta

\begin{maar}
    Verkon $G$ \emph{väritysluku} $\chi(G)$ on pienin määrä värejä, jolla sen voi värittää.
\end{maar}

\section{Sykliä ei voi 3-värittää alle $\log^* n$ kierroksessa}

Väritysluvun $\chi(B_{t,n})$ alaraja todistetaan käyttäen suunnattujen
verkkojen $\Dsn$ perhettä. Suunnatut verkot $\Dsn$ liittyvät läheisesti
naapurustoverkkoihin $B_{t,n}$. Verkon $\Dsn$ solmujoukon $V(\Dsn)$ muodostavat
kaikki vektorit muotoa
%
\begin{equation*}
    (a_1,a_2,\dots,a_s),
\end{equation*}
%
joilla pätee
%
\begin{equation*}
    1 \leq a_1 < a_2 < \dots < a_s \leq n.
\end{equation*}

Solmusta $(a_1,\dots,a_s)$ lähtee kaari muotoa
%
\begin{equation*}
    (a_2,\dots,a_s,b)
\end{equation*}
%
oleviin solmuihin, joilla $a_s < b \leq n$.

\begin{lem}
    Jos suunnatussa verkossa $D_{2t+1,n}$ on kaari $(u,v) \in E(D_{2t+1,n})$, niin
    naapurustoverkossa $B_{t,n}$ on kaari $\set{u,v} \in E(B_{t,n})$.
\end{lem}

\newcommand{\D}{D_{2t+1,n}}
\begin{proof}
    Olkoon
    \begin{equation*}
        \bar{x} = (x_1, \dots, x_{2t+1}) \in V(\D)
    \end{equation*}
    verkon $\D$ solmu.  Koska verkossa $\D$ on solmuvektoreilla
    suu\-ruus\-jär\-jes\-tys\-eh\-to
    %
    \begin{equation*}
        x_1 < x_2 < \dots < x_{2t+1},
    \end{equation*}
    %
    niin erityisesti nämä vektorin alkiot ovat keskenään erisuuria, joten
    vektori $\bar{x}$ on myös verkon $\Btn$ solmu.

    Lisäksi jos solmulla $\bar{x}$ on verkossa $\D$ naapuri
    %
    \begin{equation*}
            \bar{y} = (x_2, \dots, x_{2t+1}, y) \in V(\D),
    \end{equation*}
    %
    eli verkossa $\D$ on suunnattu kaari $(\bar{x},\bar{y}) \in E(\D)$, niin
    tällöin myös verkossa $\Btn$ on näiden solmujen välillä kaari. Tämä
    johtuu siitä, että suunnatun verkon $\D$ kaarien suuruusjärjestysehdon
    nojalla $y > x_1$, joten erityisesti $y \neq x_1$.
\end{proof}

Tästä erityisesti seuraa, että jokainen verkon $\Btn$ väritys on myös verkon
$\D$ väritys.

\begin{lem}
    Verkkojen $\Btn$ ja $\D$ väritysluvuille pätee
    \begin{equation*}
        \chi(\Btn) \geq \chi(\D).
    \end{equation*}
\end{lem}

\begin{proof}
    Olkoon $c \from V(\Btn) \to [k]$ verkon $\Btn$ väritys. Nyt jos
    %
    \begin{equation*}
            (x,y) \in E(\D)
    \end{equation*}
    %
    on verkon $\D$ kaari, niin äskeisen lemman nojalla solmujen $x$ ja
    $y$ välillä on kaari myös verkossa $\Btn$. Koska $c$ on verkon $\Btn$
    väritys, niin $c(x) \neq c(y)$. Siis $c$ on väritys myös verkolle $\D$ ja
    erityisesti verkon $\D$ voi siis myös värittää $k$:lla värillä.
\end{proof}


\begin{maar}
    Suunnatun verkon $G$ \emph{kaariverkko} $\DL(G)$ on verkko, jonka solmuja ovat
    alkuperäisen verkon $G$ kaaret ja kahden kaariverkon solmun
    %
    \begin{equation*}
        u,v \in V(\DL(G)) = E(G)
    \end{equation*}
    %
    välillä on kaari, jos $\head(u) = \tail(v)$.
\end{maar}

%TODO: havainnollistava kuva

Tarkemmin ilmaistuna,
%
\begin{align*}
    V(\DL(G)) &= E(G), \\
    E(\DL(G)) &= \set{(v,u) \in E(G) \times E(G) \mid \head(v) = \tail(u)}.
\end{align*}


\begin{lem}
    $D_{1,n}$ on $n$:n solmun täydellinen verkko, jossa kaaret on suunnattu
    pienemmästä solmusta suurempaan.
\end{lem}

\begin{proof}
    Verkon $\Dsn$ määritelmä $s$:n arvolla $1$ antaa seuraavan verkon:
    %
    \begin{align*}
        V(D_{1,n}) &= \set{(k) \mid 1 \leq k \leq n}, \\
        E(D_{1,n}) &= \set{((k), (l)) \mid k < l}.
    \end{align*}
    %
    Tässä verkossa jokaisen solmuparin välillä on kaari tasan yhteen
    suuntaan. Siis $D_{1,n}$ on suunnattu täydellinen verkko.
\end{proof}

\begin{maar}
    Kaksi suunnattua verkkoa $G$ ja $H$ ovat \emph{isomorfiset} jos niiden
    solmujoukkojen välillä on olemassa kuvaus $\varphi \from V(G) \to V(H)$
    joka toteuttaa seuraavat ehdot
    %
    \begin{enumerate}
        \item $\varphi$ on bijektio
        \item $(u,v) \in E(G)$ jos ja vain jos $(\varphi(u), \varphi(v)) \in
            E(H)$.
    \end{enumerate}
\end{maar}

Nämä ehdot toteuttavaa kuvausta kutsutaan \emph{isomorfismiksi}. Isomorfiset
verkot ovat rakenteeltaan identtisen ja eroavat toisistaan vain solmujen
nimeämisen osalta. Jos kaksi verkkoa ovat isomorfiset niin ne ovat siis
olennaisesti sama verkko.

\begin{lem}
    Verkko $\Dssn$ on verkon $\Dsn$ kaariverkko. Tarkemmin, verkot $\Dssn$ ja
    $\DL(\Dsn)$ ovat isomorfisia.
\end{lem}

\begin{proof}
    Ideana on samaistaa kaariverkon $\DL(\Dsn)$ kaari
    %
    \begin{equation*}
        \big(
            (x_1, \dots, x_s), (x_2, \dots, x_s, y)
        \big)
    \end{equation*}
    %
    verkon $\Dssn$ solmun $(x_1, \dots, x_s, y)$ kanssa. Määritellään
    siis verkkojen vä\-lil\-le kuvaus
    %
    \begin{equation*}
        \varphi \colon V(\DL(\Dsn) \to V(D_{s + 1, n})
    \end{equation*}
    %
    asettamalla
    %
    \begin{equation*}
        \varphi\big(
                   (x_1, \dots, x_s), (x_2, \dots, x_s, y)
               \big) = (x_1, \dots, x_s, y).
    \end{equation*}

    Näytetään, että $\varphi$ on isomorfismi. Ensinnäkin $\varphi$ on bijektio,
    sillä sille löytyy seuraava käänteiskuvaus $\psi \from \Dssn \to
    \DL(\Dsn)$:
    %
    \begin{equation*}
        \psi(x_1, \dots, x_n, x_{n+1}) =
        \big(
            (x_1, \dots, x_n), (x_2, \dots, x_{n+1})
        \big).
    \end{equation*}
    %
    Kuvaus $\psi$ on kuvauksen $\varphi$ käänteiskuvaus, sillä
    %
    \begin{align*}
        (\psi \compose \varphi)\big(
                                   (x_1, \dots, x_n), (x_2, \dots, x_n, y)
                               \big)
            &= \psi\big(
                       \varphi\big(
                                  (x_1, \dots, x_n), (x_2, \dots, x_n, y)
                              \big)
                   \big) \\
            &= \psi(x_1, \dots, x_n, y) \\
            &= \big(
                   (x_1, \dots, x_n), (x_2, \dots, x_n, y)
               \big) \\
\intertext{ja}
        (\varphi \compose \psi)(x_1, \dots, x_n, x_{n+1})
            &= \varphi\big(
                          \psi(x_1, \dots, x_n, x_{n+1})
                      \big) \\
            &= \varphi\big(
                          (x_1, \dots, x_n), (x_2, \dots, x_n, x_{n+1})
                      \big) \\
            &= (x_1, \dots, x_n, x_{n+1}).
    \end{align*}
    %
    Vielä täytyy näyttää, että kuvaus toteuttaa isomorfiaehdon. Olkoon
    %
    \newcommand{\x}{\bar{x}}
    \newcommand{\y}{\bar{y}}
    %TODO: korjaa tasaukset nätimmiks?
    \begin{align*}
        \x_1 &= (x_1, \dots, x_n)     \in V(\Dsn), \\
        \x_2 &= (x_2, \dots, x_{n+1}) \in V(\Dsn), \\
        \y_1 &= (y_1, \dots, y_n)     \in V(\Dsn) \text{ ja} \\
        \y_2 &= (y_2, \dots, y_{n+1}) \in V(\Dsn)
    \end{align*}
    %
    verkon $\Dsn$ solmuja. Tällöin erityisesti
    %
    \begin{align*}
        (\x_1,\x_2) &\in V(\DL(\Dsn)) \text{ ja} \\
        (\y_1,\y_2) &\in V(\DL(\Dsn))
    \end{align*}
    %
    ovat kaariverkon $\DL(\Dsn)$ solmuja. Jos $\big((\x_1, \x_2), (\y_1,
    \y_2)\big) \in E(\DL(\Dsn))$ on kaariverkon $\DL(\Dsn)$ kaari, niin
    kaariverkon määritelmän nojalla
    %
    \begin{equation*}
        \x_2 = \head\big((\x_1,\x_2)\big)
             = \tail\big((\y_1, \y_2)\big)
             = \y_1.
    \end{equation*}
    %
    Nyt $\x_2$:n ja $\y_1$:n määritelmistä seuraa, että
    %
    \begin{equation*}
        (x_2, \dots, x_{n+1}) = (y_1, \dots, y_n)
    \end{equation*}
    %
    ja erityisesti
    %
    \begin{align*}
        y_1 &= x_2\,, \\
        y_2 &= x_3\,, \\
            &\hspace{2.2mm}\vdots \\
        y_n &= x_{n+1}\,.
    \end{align*}
    %
    Koska $\x_1 \in V(\Dsn)$ ja $\y_2 \in V(\Dsn)$, niin
    $x_1 < y_1 = x_2$ ja $y_n < y_{n+1}$. Tällöin
    %
    \begin{align*}
        \big(
            \varphi(\x_1, \x_2), \varphi(\y_1, \y_2)
        \big)
            &= \big(
                   (x_1, \dots, x_{n+1}), (y_1, \dots, y_{n+1})
               \big) \\
            &= \big(
                   (x_1, y_1, y_2, \dots, y_n), (y_1, \dots, y_{n+1})
               \big) \in E(\Dssn).
    \end{align*}
    %
    Ollaan siis näytetty ensimmäinen kahdesta implikaatiosta:
    %
    \begin{equation*}
        \big((\x_1, \x_2), (\y_1, \y_2)\big) \in E(\DL(\Dsn)) \implies
        \big(\varphi(\x_1, \x_2), \varphi(\y_1, \y_2) \big) \in E(\Dssn).
    \end{equation*}

    Toisaalta jos
    %
    \begin{align*}
        \x &= (x_1, \dots, \x_{n+1}) \in V(\Dssn) \text{ ja} \\
        \y &= (y_1, \dots, \y_{n+1}) \in V(\Dssn).
    \end{align*}
    %
    ovat verkon $\Dssn$ solmuja joiden välillä on kaari, eli $(\x, \y) \in
    E(\Dssn)$, niin tällöin
    %
    \begin{equation*}
        x_2 = y_1, \dots \text{ ja } x_{n+1} = y_n.
    \end{equation*}
    %
    Nyt
    %
    \begin{align*}
        \x_1 &= (x_1, \dots, x_n), \\
        \x_2 &= (x_2, \dots, x_{n+1}), \\
        \y_1 &= (y_1, \dots, y_n) \text{ ja } \\
        \y_2 &= (y_2, \dots, y_{n+1})
    \end{align*}
    %
    ovat verkon $\Dsn$ solmuja joilla pätee
    %
    \begin{align*}
        (\x_1, \x_2) \in E(\Dsn) &\implies (\x_1, \x_2) \in V(\DL(\Dsn)) \text{ ja} \\
        (\y_1, \y_2) \in E(\Dsn) &\implies (\y_1, \y_2) \in V(\DL(\Dsn)).
    \end{align*}
    %
    Koska $\x_2 = \y_1$, niin kaariverkossa $\DL(\Dsn)$ on kaari
    %
    \begin{equation*}
        \big((\x_1, \x_2), (\y_1, \y_2)\big) \in E(\DL(\Dsn)).
    \end{equation*}
    %
    Koska
    %
    \begin{align*}
        (\x_1, \x_2) &= \varphi^{-1}(\x) \text{ ja} \\
        (\y_1, \y_2) &= \varphi^{-1}(\y),
    \end{align*}
    %
    niin väite on todistettu. Ollaan siis näytetty, että jos $(\x, \y) \in
    E(\Dssn)$ on verkon $\Dssn$ kaari, niin sen solmujen alkukuvien välillä on
    myös kaari. Tarkemmin sanottuna
    %
    \begin{equation*}
        (\x, \y) \in E(\Dssn) \implies \big(
                                           \varphi^{-1}(\x), \varphi^{-1}(\y)
                                       \big) \in E(\DL(\Dsn)).
    \end{equation*}

    Ollaan siis näytetty, että löytyy bijektio $\varphi \from V(\DL(\Dsn)) \to
    \Dssn$ joka toteuttaa isomorfiaehdon, joten verkot $\DL(\Dsn)$ ja $\Dssn$
    ovat isomorfisina olennaisesti sama verkko.
\end{proof}

%TODO: todista erikseen, että $D_{2,n} = \DL(D_{1,n})$?

Verkkojen $\Dsn$ välillä on nyt siis tarkkaan tunnettu yhteys, kun $s$:n arvot
vaihtelevat. Lisäksi verkko $D_{1,n}$ on rakenteeltaan yksinkertainen
täydellinen verkko.

\begin{lem}
    Kaikilla $n$ pätee
    %
    \begin{equation*}
        \chi(D_{1,n}) = n.
    \end{equation*}
\end{lem}

\begin{proof}
    Koska täydellisessä verkossa on kaari verkon jokaisen solmuparin välillä,
    täytyy sen jokaisella solmulla olla eri väri kuin millään muulla solmulla.
    Siispä verkon $D_{1,n}$ värittämiseen tarvitaan $n$ väriä.
\end{proof}

Seuraavan lemman avulla saadaan yhteys verkkojen $\Dsn$ ja $\Dssn$
vä\-ri\-tys\-lu\-ku\-jen välille.

\newcommand{\DLG}{\DL(G)}

\begin{lem}
    Olkoon $G$ kaariverkko. Tällöin
    %
    \begin{equation*}
        \chi(\DLG) \geq \log \chi(G).
    \end{equation*}
\end{lem}

\begin{proof}
    Olkoon $\Psi \from \DLG \to [k]$ kaariverkon $\DLG$ $k$-väritys. Koska
    verkko $\DLG$ on verkon $G$ kaariverkko, niin kuvaus $\Psi$ antaa
    jokaiselle verkon $G$ kaarelle värin. Jos $u, v \in E(G)$ ovat verkon $G$
    perättäisiä kaaria, eli $\head(u) = \tail(v)$, niin $\Psi$ antaa niille eri
    värit, $\Psi(u) \neq \Psi(v)$.

    Muodostetaan verkolle $G$ väritys $c \from G \to \powerset([k])$ joka
    värittää $G$:n $2^k$ värillä. Olkoon $x \in V(G)$ verkon $G$ solmu.
    Määritellään $x$:n väri seuraavasti:
    %
    \begin{equation*}
        c(x) = \set{\Psi(u) \mid \tail(u) = x}.
    \end{equation*}
    %
    Solmun $x$ väri on siis joukko, jossa on kaikkien solmusta $x$ lähtevien
    kaarten värit värityksessä $\Psi$. Jotta $c$ olisi laillinen väritys, se ei
    saa antaa samaa väriä kahdelle naapurisolmulle. Olkoon $u = (x,y) \in E(G)$
    verkon $G$ kaari ja siis $y \in V(G)$ solmun $x$ naapuri. Nyt $\tail(u) =
    x$, joten $u$:n väri kuuluu $x$:n värijoukkoon. Tarkemmin ilmaistuna,
    $\Psi(u) \in c(x)$.

    Toisaalta jos $\Psi(u) \in c(y)$, niin tällöin löytyy kaari $v \in E(G)$,
    joka lähtee solmusta $y$, eli $\tail(v) = y$ ja lisäksi jolle $\Psi$ antaa
    saman värin kuin $u$:lle, eli $\Psi(x) = \Psi(y)$. Tämä ei kuitenkaan ole
    mahdollista, sillä $\head(u) = y = \tail(v)$, jolloin $\Psi$ ei olisikaan
    laillinen verkon $\DLG$ väritys. Siis $c$ antaa vierekkäisille solmuille
    aina toisistaan eroavan värin, joten se täyttää väritysehdon.

    %TODO: Tämä on vähän wall of text, voisi keventää jotenkin

    Väritys $c$ antaa verkon $G$ solmuille väriksi jonkin osajoukon värityksen
    $\Psi$ väreistä. Koska $k$:n alkion joukolla on yhteensä $2^k$ osajoukkoa,
    niin $c$ värittää verkon $G$ korkeintaan $2^k$ värillä.

    Ollaan siis näytetty, että jos verkon $G$ kaariverkon $\DLG$ voi värittää $k$:lla
    värillä, niin $G$:n voi värittää $2^k$ värillä. Toisin sanoen
    %
    \begin{align*}
        \chi(G) &\leq 2^{\chi(\DLG)} \implies \\
        \log \chi(G) &\leq \chi(\DLG). \qedhere
    \end{align*}
\end{proof}

\begin{maar}
    Luonnollisella luvulla $k \in \nat$ merkitään
    %
    \begin{equation*}
        \log^{(k)} n = \overbrace{\log \log \dots \log}^{k} n.
    \end{equation*}
    %
    Luku $\log^{(k)} n$ on siis se lopputulos joka saadaan, kun luvusta $n$
    otetaan logaritmi $k$ kertaa.
\end{maar}

Aikaisemmista lemmoista saadaan nyt lopulta verkkojen $\Dsn$ vä\-ri\-tys\-lu\-vul\-le
$\chi(\Dsn)$ alaraja.

\begin{kor}
    Kaikilla $n \in \nat$ ja $s < n$ pätee
    %
    \begin{equation*}
        \chi(\Dssn) \geq \log \chi(\Dsn).
    \end{equation*}
\end{kor}

Erityisesti, koska $\chi(D_{1,n}) = n$, niin edellisestä korollaarista seuraa, että
%
\begin{align*}
    \chi(\Dsn) &\geq \log^{(s)} \chi(D_{1,n}) \implies \\
    \chi(\Dsn) &\geq \log^{(s)} n.
\end{align*}

\begin{lau}
    Hajautettu algoritmi ei voi värittää $n$:n solmun sykliä kolmella värillä
    alle $\log^* n$ kierroksessa.
\end{lau}

\begin{proof}
    Hajautettu algoritmi voi värittää $n$-syklin kolmella värillä $t$
    kierroksessa jos verkon $\Btn$ voi värittää kolmella värillä. Yhdistämällä
    edellisten lemmojen tulokset saadaan seuraava yhtälö:
    %
    \begin{equation*}
        3 \geq \chi(\Btn) \geq \chi(D_{2t+1, n}) \geq \log^{(2t)} n.
    \end{equation*}
    %
    Josta voidaan edelleen päätellä seuraavaa:
    %
    \begin{align*}
        \log^{(2t)}   n &\leq 3 \implies \\
        \log^{(2t+1)} n &\leq 2 \implies \\
        \log^{(2t+2)} n &\leq 1.
    \end{align*}

    Luku $\log^* n$ on pienin määrä toistokertoja, jolla luvusta $n$ saadaan
    logaritmeja ottamalla korkeintaan 1. Äskeisen nojalla $2(t+1)$ toistokertaa
    varmasti riittää tähän, joten
    %
    \begin{align*}
        \log^* n \leq 2(t+1)            & \implies \\
        \frac{1}{2} \log^* n - 1 \leq t. &
    \end{align*}

    Ollaan siis näytetty, että hajautettu algoritmi joka värittää $n$-syklin
    kolmella värillä käyttää siihen aikaa vähintään $\frac{1}{2} \log^* n - 1$
    kierrosta.
\end{proof}

\section{Yhteenveto}

Hajautettu algoritmi vaatii siis vähintään $\Omega(\log^* n)$ kierrosta
$n$-syklin vä\-rit\-tä\-mi\-seen kolmella värillä. Tämä alaraja on myös
asymptoottisesti tiukka, sillä Colen ja Vishkinin algoritmi värittää $n$-syklin
kolmellä värillä ajassa $\mathcal{O}(\log^* n)$.

Tässä esitetty todistus ei ota kantaa satunnaisalgoritmeihin, mutta
Naor~\cite{naor91} on näyttänyt, että vastaava alaraja pätee myös
satunnaisalgoritmeille.


% --- Back matter ---
%
% bibtex is used to generate the bibliography. The babplain style
% will generate numeric references (e.g. [1]) appropriate for theoretical
% computer science. If you need alphanumeric references (e.g [Tur90]), use
%
% \bibliographystyle{babalpha}
%
% instead.

\bibliographystyle{babplain-lf}
\bibliography{references-fi}


\end{document}

